# X Monitor

A lightweight personal web app to track keywords, tickers, and hashtags on X.com (Twitter) using the X Premium API. The app runs on a daily schedule, summarizes tweets with LLM, and presents results in a simple web dashboard.

## Features

- ✅ Monitor keywords/hashtags/tickers (e.g., `$ORCL`, `#AI`)
- ✅ Toggle: restrict results only to accounts you follow
- ✅ Daily scheduled fetch from X API
- ✅ Summarize results with DeepSeek v3.1
- ✅ Web dashboard to view latest summaries + top tweets
- ✅ REST API for configuration and results
- ✅ SQLite for local dev, ready for Postgres in production

## Tech Stack

- **Backend:** Python (FastAPI)
- **Frontend:** React + Vite + Tailwind CSS
- **Database:** SQLite (dev), Postgres (prod)
- **Scheduler:** APScheduler
- **Integrations:** X API v2, DeepSeek v3.1 API

## Setup

### 1. Clone and Setup Backend

```bash
cd backend
pip install -r requirements.txt

# Copy environment template
cp ../.env.example .env

# Edit .env with your API keys
nano .env
```

### 2. Configure X API

Get your X API credentials from [developer.twitter.com](https://developer.twitter.com) and add them to `.env`:

```env
X_API_KEY=your_api_key
X_API_SECRET=your_api_secret  
X_BEARER_TOKEN=your_bearer_token
X_ACCESS_TOKEN=your_access_token
X_ACCESS_TOKEN_SECRET=your_access_token_secret
```

### 3. Configure DeepSeek API

Add your DeepSeek API key from [platform.deepseek.com](https://platform.deepseek.com):

```env
# DeepSeek v3.1 API
DEEPSEEK_API_KEY=your_deepseek_api_key
DEEPSEEK_MODEL=deepseek-chat  # or "deepseek-reasoner" for thinking mode
```

### 4. Initialize Database

```bash
cd backend
alembic revision --autogenerate -m "Initial migration"
alembic upgrade head
```

### 5. Setup Frontend

```bash
cd frontend
npm install
```

## Running the App

### Development

Terminal 1 (Backend):
```bash
cd backend
python -m uvicorn app.main:app --reload
```

Terminal 2 (Frontend):
```bash
cd frontend  
npm run dev
```

Visit: http://localhost:3000

### API Documentation

Visit: http://localhost:8000/docs

## Usage

1. **Add Terms**: Use the dashboard to add keywords, hashtags, or tickers to monitor
2. **Configure Settings**: Toggle "Following Only" to restrict to accounts you follow
3. **Manual Run**: Click "Run Now" to immediately fetch and summarize tweets
4. **View Results**: Check the Results page for AI-generated summaries and top tweets
5. **Daily Auto-Run**: The scheduler runs daily at 8:00 AM UTC automatically

## Database Schema

### `monitored_terms`
| Column | Type | Description |
|--------|------|-------------|
| id | INTEGER PK | Auto-increment |
| keyword | TEXT | e.g. "$ORCL", "#AI" |
| restrict_following | BOOLEAN | true = only from followed accounts |
| active | BOOLEAN | toggle on/off |
| created_at | TIMESTAMP | creation time |

### `results`
| Column | Type | Description |
|--------|------|-------------|
| id | INTEGER PK | Auto-increment |
| keyword_id | INTEGER FK | references monitored_terms.id |
| tweets_raw | JSON | raw tweets data |
| summary | TEXT | AI-generated summary |
| created_at | TIMESTAMP | job run time |

## API Endpoints

- `GET /api/terms` - List monitored terms
- `POST /api/terms` - Add new term
- `PUT /api/terms/{id}` - Update term
- `DELETE /api/terms/{id}` - Remove term
- `GET /api/results` - List summaries
- `GET /api/results/{id}` - Get specific result
- `POST /api/run` - Manually trigger analysis

## Deployment

### Railway.app (Recommended)

Railway provides seamless deployment with automatic Postgres setup. Follow these steps:

#### 1. Prerequisites
- GitHub account with this repository
- Railway account ([railway.app](https://railway.app))

#### 2. Create Railway Project
```bash
# Option 1: Railway CLI (recommended)
npm install -g @railway/cli
railway login
railway init
railway link

# Option 2: Web interface
# Visit railway.app, connect GitHub, select repository
```

#### 3. Add Postgres Database
```bash
# Using Railway CLI
railway add postgresql

# Or via web: Project → Add Service → Database → PostgreSQL
```

#### 4. Configure Environment Variables
Set these in Railway dashboard (Project → Variables):

```env
# Database (auto-generated by Railway Postgres plugin)
DATABASE_URL=postgresql://postgres:password@host:port/railway

# Copy this value to DB_URL for our app
DB_URL=${{Postgres.DATABASE_URL}}

# X API Credentials
X_API_KEY=your_x_api_key
X_API_SECRET=your_x_api_secret  
X_BEARER_TOKEN=your_x_bearer_token
X_ACCESS_TOKEN=your_x_access_token
X_ACCESS_TOKEN_SECRET=your_x_access_token_secret

# DeepSeek v3.1 API
DEEPSEEK_API_KEY=your_deepseek_key
DEEPSEEK_MODEL=deepseek-chat

# Optional: Scheduler settings
SCHEDULER_TIMEZONE=UTC
DAILY_RUN_HOUR=8
DAILY_RUN_MINUTE=0
```

#### 5. Deploy Backend Service

Create `backend/railway.toml`:
```toml
[build]
  builder = "nixpacks"
  buildCommand = "pip install -r requirements.txt"

[deploy]
  startCommand = "alembic upgrade head && python -m uvicorn app.main:app --host 0.0.0.0 --port $PORT"
  healthcheckPath = "/"
  healthcheckTimeout = 100
  restartPolicyType = "on_failure"
  restartPolicyMaxRetries = 10

[variables]
  PYTHONPATH = "/app"
```

#### 6. Deploy Frontend Service  

Create `frontend/railway.toml`:
```toml
[build]
  builder = "nixpacks" 
  buildCommand = "npm install && npm run build"

[deploy]
  startCommand = "npx serve -s dist -l $PORT"
  healthcheckPath = "/"
  
[variables]
  VITE_API_BASE_URL = "${{Backend.RAILWAY_PUBLIC_DOMAIN}}"
```

#### 7. Database Migration

Railway will automatically run migrations on deploy thanks to the `startCommand`. For manual migration:

```bash
# Connect to your Railway project
railway connect

# Run migrations manually  
railway run alembic upgrade head
```

#### 8. Verify Deployment

1. **Backend Health Check**: Visit `https://your-backend.railway.app/`
2. **API Docs**: Visit `https://your-backend.railway.app/docs`  
3. **Frontend**: Visit `https://your-frontend.railway.app/`
4. **Database**: Check Railway dashboard for connection details

### Alternative Deployment Options

#### Docker Deployment

Create `backend/Dockerfile`:
```dockerfile
FROM python:3.11-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .
CMD ["sh", "-c", "alembic upgrade head && python -m uvicorn app.main:app --host 0.0.0.0 --port ${PORT:-8000}"]
```

#### Manual Server Deployment

```bash
# Install dependencies
pip install -r backend/requirements.txt

# Set environment variables
export DB_URL="postgresql://user:password@host:port/database"
export X_BEARER_TOKEN="your_token"
# ... other env vars

# Run migrations
cd backend
alembic upgrade head

# Start services
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 &
cd ../frontend && npm run build && npx serve -s dist -l 3000 &
```

### Environment Variables Reference

#### Required for All Deployments
```env
# Database Connection
DB_URL=postgresql://user:password@host:port/database

# X API Authentication (Get from developer.twitter.com)
X_API_KEY=your_consumer_key
X_API_SECRET=your_consumer_secret
X_BEARER_TOKEN=your_bearer_token  
X_ACCESS_TOKEN=your_access_token
X_ACCESS_TOKEN_SECRET=your_access_token_secret

# DeepSeek v3.1 API
DEEPSEEK_API_KEY=sk-your-deepseek-key
DEEPSEEK_MODEL=deepseek-chat
```

#### Optional Configuration
```env
# Scheduler Settings
SCHEDULER_TIMEZONE=UTC
DAILY_RUN_HOUR=8
DAILY_RUN_MINUTE=0

# Railway Specific
PORT=8000
PYTHONPATH=/app
```

### Database Schema Migration

The app automatically creates/updates database tables on startup. For manual control:

```bash
# Generate new migration after model changes
alembic revision --autogenerate -m "Description of changes"

# Apply migrations
alembic upgrade head

# Rollback migration
alembic downgrade -1
```

### Troubleshooting

#### Common Issues
1. **Migration Errors**: Ensure `DB_URL` is correctly set and database is accessible
2. **API Rate Limits**: Check X API quota and rate limit status
3. **Memory Issues**: Railway provides 512MB by default, upgrade if needed
4. **Build Timeouts**: Increase timeout in railway.toml if builds fail

#### Logs and Debugging
```bash
# Railway CLI logs
railway logs

# Check service status
railway status

# Connect to database
railway connect postgresql
```

## License

MIT